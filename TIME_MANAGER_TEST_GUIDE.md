# 时间管理系统测试指南

## 测试准备

✅ 开发服务器已启动：http://localhost:5173/

## 功能验证清单

### 1. 基本功能测试

#### URL导入功能
- [ ] 打开浏览器访问 http://localhost:5173/
- [ ] 测试导入一个Civitai模型URL，确认基本功能正常
- [ ] 查看浏览器控制台，确认时间管理器启动日志：
  ```
  📅 时间管理器已启动，当前日期: 2025-XX-XX
  📅 日期监控已启动 (30秒检查间隔)
  📋 已添加日期变化回调，总计: 1
  ```

#### 模型添加验证
- [ ] 导入模型后检查控制台日志，确认保存到当天：
  ```
  ✅ 新模型已保存到缓存并记录到今天: [模型名称]
  📝 模型 [模型名称] (ID: [ID]) 已添加到当前会话
  ```

### 2. 跨天刷新测试

#### 方法一：手动修改系统时间（推荐）
1. [ ] 导入几个模型到当前日期
2. [ ] 保持应用打开状态
3. [ ] 修改系统时间到明天（或前一天）
4. [ ] 等待30秒或切换浏览器标签页触发检测
5. [ ] 观察控制台日志，应该看到：
   ```
   🚨 检测到日期变化: 2025-XX-XX -> 2025-XX-XX
   🔄 处理日期变化: 2025-XX-XX -> 2025-XX-XX
   📂 跨天后重新加载了 X 个模型
   🔄 界面已刷新
   ```

#### 方法二：代码内测试（开发者选项）
1. [ ] 在浏览器控制台执行：
   ```javascript
   // 手动触发日期检查
   window.__simple_time_manager?.forceCheckDate();
   ```

### 3. 界面同步测试

#### 日历组件刷新
- [ ] 跨天后确认日历显示正确的日期
- [ ] 确认模型数据在日历中正确显示

#### 数据网格刷新
- [ ] 确认数据网格显示当天的模型数据
- [ ] 确认没有前一天的数据叠加

### 4. 稳定性测试

#### 长时间运行测试
- [ ] 保持应用运行30分钟以上
- [ ] 在不同时间段导入模型
- [ ] 确认没有内存泄漏或异常错误

#### 错误处理测试
- [ ] 网络错误情况下测试模型导入
- [ ] 确认时间管理器错误不影响主功能

### 5. 性能测试

#### 定时器性能
- [ ] 观察30秒间隔的检查是否正常
- [ ] 确认没有明显的性能影响
- [ ] 检查浏览器任务管理器确认CPU使用正常

#### 内存管理
- [ ] 刷新页面确认旧的定时器被清理
- [ ] 长时间使用确认内存使用稳定

## 预期行为

### 正常日志输出
启动时：
```
📅 时间管理器已启动，当前日期: 2025-01-12
📅 日期监控已启动 (30秒检查间隔)
⏰ 已注册跨天刷新监听器
```

添加模型时：
```
🔍 开始获取模型信息: [URL]
📦 成功获取模型数据: [模型名] (ID: [ID])
🆕 准备添加新模型: [模型名] (ID: [ID])
✅ 新模型已保存到缓存并记录到今天: [模型名]
📝 模型 [模型名] (ID: [ID]) 已添加到当前会话
🎉 模型添加成功: [模型名]
```

跨天时：
```
🚨 检测到日期变化: 2025-01-11 -> 2025-01-12
🔄 处理日期变化: 2025-01-11 -> 2025-01-12
📂 跨天后重新加载了 X 个模型
🔄 界面已刷新
```

关闭应用时：
```
🗑️  已移除跨天刷新监听器
```

### 异常情况处理
- 网络错误时模型导入失败，但时间管理器继续工作
- 时间管理器回调失败时，主功能不受影响
- 页面刷新时定时器正确重新初始化

## 故障排除

### 时间管理器未启动
- 检查控制台是否有启动日志
- 确认 simple_time_manager.ts 文件存在
- 检查 LoraModelDisplay.vue 中的导入语句

### 跨天检测不工作
- 确认系统时间修改后等待30秒
- 尝试切换浏览器标签页触发 visibilitychange 事件
- 检查控制台是否有相关错误

### 界面不刷新
- 确认日历和数据网格组件的 ref 正确
- 检查 nextTick 是否正确执行
- 验证组件的 refresh 方法是否存在

## 测试完成确认

完成所有测试项目后，确认：
- [ ] 基本URL导入功能正常
- [ ] 跨天刷新机制工作正常
- [ ] 界面组件正确同步
- [ ] 没有明显的性能或稳定性问题
- [ ] 错误处理机制正常工作

---

**注意**: 这个时间管理系统是非侵入式设计，即使出现问题也不会影响核心的模型导入导出功能。测试重点关注跨天刷新的正确性和系统稳定性。
